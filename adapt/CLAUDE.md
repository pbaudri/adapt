# Adapt — Claude Code Instructions

## Project

Nutrition tracking app with a zero-judgment philosophy.
Full architecture reference: see `ARCHITECTURE.md` at this level.

Never start coding without having read `ARCHITECTURE.md` first.

## Context7

Always use Context7 to fetch up-to-date documentation before writing any code.
This is mandatory at project initialisation and when adding a new package.

Priority packages to resolve via Context7:
- `serverpod` + `serverpod_client`
- `flutter_riverpod` + `riverpod_annotation` + `riverpod_generator`
- `freezed` + `freezed_annotation`
- `go_router`
- `melos`

Usage in Claude Code:
```
use context7 to get the latest docs for [package_name] before implementing
```

## Monorepo

Managed by Melos. Four packages:

| Package | Role |
|---|---|
| `adapt_server` | Backend — endpoints, models, services |
| `adapt_client` | Generated by Serverpod — **NEVER edit manually** |
| `adapt_flutter` | Flutter app — features, screens, providers |
| `adapt_theme` | Design system — theme, colors, shared widgets |

## Key Commands

```bash
melos run generate      # Regenerates Serverpod models + client
melos run build_runner  # Regenerates Freezed + Riverpod in adapt_flutter
melos run lint          # Analyze all packages
melos run test          # Run all tests
melos bootstrap         # Install all dependencies
```

Always run `melos run generate` after any model change in `adapt_server/lib/src/models/`.
Always run `melos run build_runner` after any Freezed or Riverpod annotation change.

## Critical Rules (apply everywhere)

- Units are **always stored in SI** (kg, cm). `weight_unit` / `height_unit` are display preferences only. Conversion in `unit_converter.dart` only.
- `caloriesKcal` is **NEVER** part of `MealCorrectionInput` — always auto-calculated server-side using `(protein_g × 4) + (carbs_g × 4) + (fat_g × 9)`.
- `adapt_client` is fully generated — never touch it.
- Guest mode: `is_guest` defaults to `true`, sign-in is always optional and never forced.
- Zero-judgment language: never use words like "bad", "excess", "cheat" in any AI prompt, message, or UI string.

## Architecture Summary

```
adapt/
├── CLAUDE.md
├── ARCHITECTURE.md
├── melos.yaml
├── adapt_server/
├── adapt_client/        ← generated, do not edit
├── adapt_theme/
└── adapt_flutter/
```